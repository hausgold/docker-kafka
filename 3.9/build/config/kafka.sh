#!/usr/bin/env bash

# See: https://bit.ly/3UNWpq2
# See: https://bit.ly/3QLrxFC

# Configure application defaults
export KAFKA_NODE_ID=${KAFKA_NODE_ID:-'1'}
export KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=${KAFKA_LISTENER_SECURITY_PROTOCOL_MAP:-'CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT'}
export KAFKA_ADVERTISED_LISTENERS=${KAFKA_ADVERTISED_LISTENERS:-"PLAINTEXT_HOST://${MDNS_HOSTNAME}:9092,PLAINTEXT://${MDNS_HOSTNAME}:19092"}
export KAFKA_PROCESS_ROLES=${KAFKA_PROCESS_ROLES:-'broker,controller'}
export KAFKA_CONTROLLER_QUORUM_VOTERS=${KAFKA_CONTROLLER_QUORUM_VOTERS:-'1@localhost:29093'}
export KAFKA_LISTENERS=${KAFKA_LISTENERS:-'CONTROLLER://:29093,PLAINTEXT_HOST://:9092,PLAINTEXT://:19092'}
export KAFKA_INTER_BROKER_LISTENER_NAME=${KAFKA_INTER_BROKER_LISTENER_NAME:-'PLAINTEXT'}
export KAFKA_CONTROLLER_LISTENER_NAMES=${KAFKA_CONTROLLER_LISTENER_NAMES:-'CONTROLLER'}
export CLUSTER_ID=${CLUSTER_ID:-'4L6g3nShT-eMCtK--X86sw'}
export KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=${KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR:-'1'}
export KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=${KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS:-'0'}
export KAFKA_TRANSACTION_STATE_LOG_MIN_ISR=${KAFKA_TRANSACTION_STATE_LOG_MIN_ISR:-'1'}
export KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=${KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR:-'1'}
export KAFKA_LOG_DIRS=${KAFKA_LOG_DIRS:-'/tmp/kraft-combined-logs'}

# Start the regular bootstrapping
exec /etc/kafka/docker/run
